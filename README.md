# Запускаем парсеры по расписанию
(ft. редис и сельдерей) by Павленко Алексей РИМ-140950
## Описание
Платформа позволяет запускать парсеры по назначенному времени. Можно **удалить** назначенную задачу или **выполнить прямо сейчас**. Все поставленные задачи сохраняются даже после перезагрузки. Результаты (или ошибку) выполнения можно скачать на странице задачи.
## Стек
+ Python
+ FastAPI
+ FastUI
+ Celery
+ Redis
+ SQLite
## Quick Start (как поднять все это)
### 1. Поднять Redis на чем-нибудь
Например на Docker:
1. Включаем докер
2. Качаем образ Redis с создаем контейнер с ним

По умолчанию порт 32768, если ничего не менять. При желании можно настроить в `parser_processer.py`.
### 2. Подготовить окружение
1. Клонируем репо
   - Создаем виртуальное окружение если нужно
2. Ставим зависимости `pip install -r requirements.txt`
### 3. Запускаем Celery
Фигачим в терминал  `celery -A parser_processer.celeryApp worker --loglevel=info --pool=solo --statedb=CeleryDb/worker.state`, где
   - `parser_processer.celeryApp` - `имя_файла:переменная_celery`
   - `--pool=solo` нужно чтобы это запустилось на винде, потому что там какая-то беда с потоками
   - `--statedb=CeleryDb/worker.state` путь куда сельдерей будет сохранять свои штуки, например задачи помеченные на удаление. Мы же не хотим, чтобы после перезапуска он все забыл?
### 4. Поднимаем веб-интерфейс...
В другой терминал `uvicorn main:fast_api_app --reload --port=8000`. `--port` можно не писать, по умолчанию открывает на 8000.
### 5. ...И открываем его
uvicorn должен выдать ссылку в консоль, по-умолчанию `http://127.0.0.1:8000`
## Как добавить свои парсеры
Новые парсеры добавляются в папку `Parsing results` как `.py` файлы. Есть несколько требований:
1. Собственно формат файла `.py`, иначе прога даже не увидит его
2. Файл должен содержать обязательный метод `run()` который можно вызывать без аргументов. В другом случае словите ошибку.
3. Метод должен возвращать результаты выполнения, в том виде, в котором вы хотите его видеть. Они просто будут записаны как есть в txt-файл.
